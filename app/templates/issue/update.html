{% extends 'base.html' %}

{% block header %}
<h1>{% block title %}{{ issue.title }}{% endblock %}</h1>
{% endblock %}

{% block content %}

<div>{{ _('%(issue)s submitted by %(username)s on %(datetime)s at %(site)s - %(location)s',
    issue=_('Computer issue') if issue.type.name == "computer" else _('Technical issue'),
    username=issue.username,
    datetime=issue.created|local_datetime,
    site=issue.site,
    location=issue.location,
    ) }}
</div>

{% if issue.closed %}
<div>{{ _('Closed on %(datetime)s', datetime=issue.closed|local_datetime) }}</div>
{% endif %}

{% if issue.computer_number %}
<div>{{ _('Equipment: %(computer_number)s', computer_number=issue.computer_number) }}</div>
{% endif %}

{% if issue.description %}
<div>{{ issue.description }}</div>
{% endif %}
<hr>

{% for message in messages %}
<div>{{ _('Message from %(username)s on %(datetime)s',
    username=message.username if message.username else message.user.username,
    datetime=message.created|local_datetime
    ) }}
</div>

{% if message.content %}
<div>{{ message.content }}</div>
{% endif %}

<hr>
{% endfor %}

<form method="post">
    {{ form.hidden_tag() }}

    {{ form.content.label }}
    {{ form.content }}

    {{ form.submit() }}
</form>

{% if current_user.role.authorized('change_to_technical_issue', issue=issue) %}
<div><a href="{{ url_for('issue.change_type', id=id) }}" data-confirmation="{{ _('Please confirm') }}"
        onclick="return confirm(this.dataset.confirmation)">{{ _('Change to technical issue') }}</a></div>
{% endif %}

{% if current_user.role.authorized('change_to_computer_issue', issue=issue) %}
<div><a href="{{ url_for('issue.change_type', id=id) }}" data-confirmation="{{ _('Please confirm') }}"
        onclick="return confirm(this.dataset.confirmation)">{{ _('Change to computer issue') }}</a></div>
{% endif %}

{% if current_user.role.authorized('close_issue', issue=issue) %}
<div><a href="{{ url_for('issue.close', id=id) }}" data-confirmation="{{ _('Please confirm') }}"
        onclick="return confirm(this.dataset.confirmation)">{{ _('Close issue') }}</a></div>
{% endif %}

{% if current_user.role.authorized('reopen_issue', issue=issue) %}
<div><a href="{{ url_for('issue.reopen', id=id) }}" data-confirmation="{{ _('Please confirm') }}"
        onclick="return confirm(this.dataset.confirmation)">{{ _('Reopen issue') }}</a></div>
{% endif %}

<!-- _('Please confirm') is needed as a comment for gettext extraction -->

{% endblock %}
